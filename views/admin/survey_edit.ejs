<%- include('../partials/header', { user: user }) %>
<%- include('_shared_styles') %>

<style>
    .survey-edit-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .survey-edit-card {
        background: white;
        border-radius: var(--radius-card);
        padding: 2.5rem;
        box-shadow: var(--shadow-soft);
        margin-bottom: 2rem;
    }

    .survey-edit-header {
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 1.5rem;
        margin-bottom: 2rem;
    }

    .survey-edit-header h1 {
        font-family: 'DM Serif Display', serif;
        font-size: 2rem;
        color: var(--col-blue);
        margin-bottom: 0.5rem;
    }

    .survey-edit-header .survey-info {
        font-family: 'Montserrat', sans-serif;
        color: var(--text-light);
        font-size: 0.95rem;
    }

    .form-section {
        margin-bottom: 2rem;
    }

    .form-section-title {
        font-family: 'DM Serif Display', serif;
        font-size: 1.3rem;
        color: var(--col-blue);
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #f0f0f0;
    }

    .score-input-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .score-field {
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        border-radius: 12px;
        padding: 1.5rem;
        border: 2px solid #e0e0e0;
        transition: border-color 0.3s ease;
    }

    .score-field:focus-within {
        border-color: var(--col-blue);
    }

    .score-field label {
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        color: var(--col-dark-gray);
        margin-bottom: 0.5rem;
        display: block;
        font-size: 0.9rem;
    }

    .score-field input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
        font-family: 'DM Serif Display', serif;
    }

    .score-field input:focus {
        outline: none;
        border-color: var(--col-blue);
        box-shadow: 0 0 0 3px rgba(148, 170, 185, 0.1);
    }

    .score-scale {
        font-size: 0.75rem;
        color: #999;
        margin-top: 0.5rem;
        text-align: center;
    }

    .comments-section {
        margin-top: 2rem;
    }

    .comments-textarea {
        width: 100%;
        min-height: 150px;
        padding: 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        resize: vertical;
    }

    .comments-textarea:focus {
        outline: none;
        border-color: var(--col-blue);
        box-shadow: 0 0 0 3px rgba(148, 170, 185, 0.1);
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #f0f0f0;
    }
</style>

<div class="container mt-4 survey-edit-container">
    <!-- Header -->
    <div class="survey-edit-card">
        <div class="survey-edit-header">
            <h1>Edit Survey Response</h1>
            <div class="survey-info">
                <strong>Event:</strong> <%= survey.event_name %><br>
                <strong>Participant:</strong> <%= survey.participant_first_name %> <%= survey.participant_last_name %><br>
                <strong>Survey ID:</strong> #<%= survey.survey_id %>
            </div>
        </div>

        <!-- Flash Messages -->
        <% if (typeof messages !== 'undefined') { %>
            <% if (messages.error && messages.error.length > 0) { %>
                <div class="alert alert-danger admin-alert" role="alert">
                    <%= messages.error[0] %>
                </div>
            <% } %>
            <% if (messages.success && messages.success.length > 0) { %>
                <div class="alert alert-success admin-alert" role="alert">
                    <%= messages.success[0] %>
                </div>
            <% } %>
        <% } %>

        <form action="/admin/surveys/edit/<%= survey.survey_id %>" method="POST">
            <!-- Scores Section -->
            <div class="form-section">
                <h3 class="form-section-title">Survey Scores (0-5 Scale)</h3>
                <div class="score-input-group">
                    <div class="score-field">
                        <label for="survey_satisfaction_score">Satisfaction Score</label>
                        <input type="number" id="survey_satisfaction_score" name="survey_satisfaction_score"
                            min="0" max="5" step="0.1"
                            value="<%= survey.survey_satisfaction_score !== null ? survey.survey_satisfaction_score : '' %>"
                            required>
                        <div class="score-scale">Scale: 0-5</div>
                    </div>
                    <div class="score-field">
                        <label for="survey_usefulness_score">Usefulness Score</label>
                        <input type="number" id="survey_usefulness_score" name="survey_usefulness_score"
                            min="0" max="5" step="0.1"
                            value="<%= survey.survey_usefulness_score !== null ? survey.survey_usefulness_score : '' %>"
                            required>
                        <div class="score-scale">Scale: 0-5</div>
                    </div>
                    <div class="score-field">
                        <label for="survey_instructor_score">Instructor Score</label>
                        <input type="number" id="survey_instructor_score" name="survey_instructor_score"
                            min="0" max="5" step="0.1"
                            value="<%= survey.survey_instructor_score !== null ? survey.survey_instructor_score : '' %>"
                            required>
                        <div class="score-scale">Scale: 0-5</div>
                    </div>
                    <div class="score-field">
                        <label for="survey_recommendation_score">Recommendation Score (NPS)</label>
                        <input type="number" id="survey_recommendation_score" name="survey_recommendation_score"
                            min="0" max="5" step="0.1"
                            value="<%= survey.survey_recommendation_score !== null ? survey.survey_recommendation_score : '' %>"
                            required>
                        <div class="score-scale">Scale: 0-5 (NPS)</div>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="form-section comments-section">
                <h3 class="form-section-title">Participant Comments</h3>
                <textarea id="survey_comments" name="survey_comments" class="comments-textarea"
                    placeholder="Enter participant comments or feedback..."><%= survey.survey_comments || '' %></textarea>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="admin-btn admin-btn-success">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <a href="/admin/surveys/<%= survey.survey_id %>" class="admin-btn admin-btn-secondary">
                    Cancel
                </a>
                <a href="/admin/surveys" class="admin-btn admin-btn-secondary">
                    Back to Surveys
                </a>
            </div>
        </form>
    </div>
</div>

<%- include('../partials/footer') %>

